# ncats-kg-release-pipeline

This is the repository for driving a Jenkins Multibranch pipeline.

Each branch will have its own version of `Jenkinsfile` that drives the pipeline.

Available branches:
* `master` - contains a [Jenkinsfile](https://github.com/deepakunni3/ncats-kg-release-pipeline/blob/master/Jenkinsfile) which serves as a template for a Jenkins build. The `master` branch should never generate any artifacts.
* `test` - contains a [Jenkinsfile](https://github.com/deepakunni3/ncats-kg-release-pipeline/blob/test/Jenkinsfile) which downloads test datasets, parses them using KGX to build a KG. The output is a KG as a csv.


### How do I run Jenkins

You can set up Jenkins locally, as a Docker container or run on a server.

#### Run Jenkins as a Docker container

To run Jenkins as a Docker container,
```
docker run -it \
  -p 3000:8080 \
  deepakunni3/ncats-jenkins
```

`deepakunni3/ncats-jenkins` is a Docker image that prepares an environment equipped to run KGX, and other tools, alongside Jenkins. This image is generated by this [Dockerfile](https://github.com/deepakunni3/ncats-kg-release-pipeline/blob/master/Dockerfile).

#### Run Jenkins as a Docker container which can spin up additional Docker containers

Use the following command if your pipeline is going to generate additional Docker containers,
```
docker run -it \
  -p 3000:8080 \
  -v /var/run/docker.sock:/var/run/docker.sock \
  deepakunni3/ncats-jenkins
```

#### Run Jenkins as a Docker container and preserve generated artifacts

If your pipeline generates artifacts and you would like to preserve these then you can mount a folder from the host to `$JENKINS_HOME`, in this case `/var/jenkins_home`, such that any archived files (after a successful Jenkins build) are written to the mounted folder instead.

Ex:
```
 docker run -it \
  -p 3333:8080  \
  -v /my/host/folder:/var/jenkins_home \
  -v /var/run/docker.sock:/var/run/docker.sock \
  deepakunni3/ncats-jenkins 
```
